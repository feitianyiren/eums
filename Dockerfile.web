FROM python:2.7
MAINTAINER eums <eums@thoughtworks.com>

ENV PYTHONUNBUFFERED 1

RUN export DEBIAN_FRONTEND=noninteractive

# Add unpriviledged worker user
RUN adduser --disabled-password --gecos '' worker

COPY requirements.txt .
RUN pip install -r requirements.txt

COPY scripts/packaging/eums.uwsgi.ini /etc/uwsgi/sites/eums.uwsgi.ini
COPY scripts/deployment/celery.sh /celery.sh
COPY ./build/ /eums/
COPY ./build/eums.sh /eums/eums.sh
RUN chmod +x /eums/eums.sh


WORKDIR /eums/
EXPOSE 8000

ENTRYPOINT [ "/eums/eums.sh" ]
CMD [ "uwsgi" ]
